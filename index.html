<!-- Save this as index.html and deploy via GitHub Pages or Netlify -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monthly Expenses Tracker</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f0f4f8;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    input {
      width: 100%;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    input:disabled {
      background: #eee;
    }
    .totals {
      background: #e2e8f0;
      font-weight: bold;
    }
    .per-head {
      font-weight: 600;
      background: #e6fffa;
      padding: 15px;
      border-radius: 10px;
    }
    button {
      padding: 10px 16px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .unlock-btn { background: #38bdf8; color: white; }
    .action-btn { background: #4ade80; color: white; }
    .export-btn { background: #facc15; color: #333; }
  </style>
</head>
<body>
<div class="container">
  <h2>Month: <input type="month" id="monthSelector" /></h2>
  <table id="expenseTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Particulars</th>
        <th>Bhushan <button class="unlock-btn" onclick="unlock('A')">ðŸ”“</button></th>
        <th>Dheeraj <button class="unlock-btn" onclick="unlock('B')">ðŸ”“</button></th>
        <th>Saurabh <button class="unlock-btn" onclick="unlock('C')">ðŸ”“</button></th>
      </tr>
    </thead>
    <tbody id="expenseBody"></tbody>
    <tfoot>
      <tr class="totals">
        <td colspan="2">Total</td>
        <td id="totalA">0</td>
        <td id="totalB">0</td>
        <td id="totalC">0</td>
      </tr>
    </tfoot>
  </table>

  <button class="action-btn" onclick="addRow()">âž• Add Row</button>
  <button class="action-btn" onclick="updateData()">Update</button>
  <button class="export-btn" onclick="exportFrozen()">Export</button>
  <div id="perHeadSummary" class="per-head"></div>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAG0iw8BdwM6mHN9IQy1VKzUeLmU_f_QXw",
    authDomain: "monthly-expenses-74e23.firebaseapp.com",
    databaseURL: "https://monthly-expenses-74e23-default-rtdb.firebaseio.com",
    projectId: "monthly-expenses-74e23",
    storageBucket: "monthly-expenses-74e23.appspot.com",
    messagingSenderId: "164896447417",
    appId: "1:164896447417:web:9c9b8b7b737dc775bff468"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const expenseBody = document.getElementById("expenseBody");
  const totalA = document.getElementById("totalA");
  const totalB = document.getElementById("totalB");
  const totalC = document.getElementById("totalC");
  const perHeadSummary = document.getElementById("perHeadSummary");
  const monthSelector = document.getElementById("monthSelector");

  const passcodes = { A: "123A", B: "123B", C: "123C" };

  function unlock(person) {
    const entered = prompt("Enter passcode for " + person);
    if (entered === passcodes[person]) {
      document.querySelectorAll(".p" + person.toLowerCase()).forEach(inp => inp.disabled = false);
    } else {
      alert("Incorrect passcode.");
    }
  }

  function addRow(date = "", part = "", a = 0, b = 0, c = 0) {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="date" value="${date}"></td>
      <td><input type="text" value="${part}"></td>
      <td><input type="number" class="pa" value="${a}" disabled></td>
      <td><input type="number" class="pb" value="${b}" disabled></td>
      <td><input type="number" class="pc" value="${c}" disabled></td>
    `;
    expenseBody.appendChild(row);
  }

  function calculateTotals() {
    let a = 0, b = 0, c = 0;
    document.querySelectorAll(".pa").forEach(i => a += +i.value || 0);
    document.querySelectorAll(".pb").forEach(i => b += +i.value || 0);
    document.querySelectorAll(".pc").forEach(i => c += +i.value || 0);
    totalA.textContent = a.toFixed(2);
    totalB.textContent = b.toFixed(2);
    totalC.textContent = c.toFixed(2);
    const total = a + b + c;
    const share = total / 3;
    perHeadSummary.innerHTML = `Per Head: â‚¹${share.toFixed(2)}<br>
      Bhushan: â‚¹${(a - share).toFixed(2)}<br>
      Dheeraj: â‚¹${(b - share).toFixed(2)}<br>
      Saurabh: â‚¹${(c - share).toFixed(2)}`;
  }

  function updateData() {
    const month = monthSelector.value;
    if (!month) return alert("Please select a month");
    const rows = [...expenseBody.querySelectorAll("tr")].map(row => {
      const inputs = row.querySelectorAll("input");
      return {
        date: inputs[0].value,
        part: inputs[1].value,
        a: +inputs[2].value || 0,
        b: +inputs[3].value || 0,
        c: +inputs[4].value || 0
      };
    });
    db.ref("expenses/" + month).set(rows).then(() => {
      alert("Updated");
      calculateTotals();
    });
  }

  function loadData(month) {
    db.ref("expenses/" + month).on("value", snap => {
      expenseBody.innerHTML = "";
      const data = snap.val();
      if (data) data.forEach(d => addRow(d.date, d.part, d.a, d.b, d.c));
      calculateTotals();
    });
  }

  monthSelector.addEventListener("change", e => {
    loadData(e.target.value);
  });

  function exportFrozen() {
    calculateTotals();
    const html = document.documentElement.cloneNode(true);
    html.querySelectorAll("script").forEach(e => e.remove());
    html.querySelectorAll("input").forEach(i => {
      i.setAttribute("readonly", true);
      i.style.border = "none";
      i.style.background = "#fff";
      i.style.pointerEvents = "none";
    });
    const blob = new Blob(["<!DOCTYPE html>\n" + html.outerHTML], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "FrozenExpense.html";
    a.click();
  }
</script>
</body>
</html>
